@page "/scrabblegame"
@using System.Linq

<div class="scrabble-layout">
    <div class="game-section">
        <div class="score-display">
            <h3>Current Score: @currentScore</h3>
            <h4>Last Word Score: @lastWordScore</h4>
        </div>
        <main class="scrabble-board" tabindex="0" aria-label="Scrabble Board" role="region">
            <table class="board-table" aria-label="Scrabble Board Preview">
                <tr>
                    @for (int col = 0; col < 15; col++)
                    {
                        var currentCol = col;
                        <td class="board-cell @(currentCol == 7 ? "center-cell" : "")" 
                            @onclick="() => OnCellClick(currentCol)">
                            @GetBoardCell(currentCol)
                        </td>
                    }
                </tr>
            </table>

            <div class="tile-rack" aria-label="Your Tiles">
                <span>Tiles:</span>
                @for (int i = 0; i < tileRack.Count; i++)
                {
                    var index = i;
                    var tile = tileRack[i];
                    <button class="tile-btn @(selectedLetters.Any(l => !l.isCenter && l.index == index) ? "selected" : "")"
                            @key="@($"tile_{index}_{tile}")"
                            @onclick="@(e => SelectTile(index))"
                            @onclick:preventDefault="true"
                            @onclick:stopPropagation="true"
                            type="button">
                        @tile
                        <span class="letter-score">@letterScores[tile]</span>
                    </button>
                }
            </div>            <div class="selected-word" aria-label="Selected Word">
                <div class="selected-word-label">Word you are building:</div>
                <div class="selected-word-value" role="group" aria-label="Selected letters">
                    @if (!HasSelectedLetters)
                    {
                        <span class="placeholder">(Click tiles and center letter to build a word)</span>
                    }
                    else
                    {
                        @foreach (var (letter, isCenter) in GetSelectedWord())
                        {
                            <button type="button" 
                                    class="built-word-tile @(isCenter ? "center-letter" : "")"
                                    @onclick="() => RemoveLetter(letter, isCenter)">
                                @letter
                            </button>
                        }
                    }
                </div>
                
                @if (!string.IsNullOrEmpty(validationMessage))
                {
                    <div class="validation-message @(validationMessage.Contains("Great!") ? "success" : "error")">
                        @validationMessage
                    </div>
                }
                
                @if (isValidatingWord)
                {
                    <div class="validation-loading">
                        <span>Checking if word exists...</span>
                    </div>
                }
            </div>            <nav class="scrabble-controls" aria-label="Game Controls">
                <button @onclick="ShuffleTiles" type="button">Shuffle Tiles</button>
                <button @onclick="PlayWord" type="button" disabled="@isValidatingWord">
                    @if (isValidatingWord)
                    {
                        <span>Validating...</span>
                    }
                    else
                    {
                        <span>Play Word</span>
                    }
                </button>
                <button @onclick="ClearSelection" type="button">Clear Selection</button>
                <button @onclick="StartNewGame" type="button">New Game</button>
            </nav>
        </main>
    </div>
    
    <section class="instructions-section" aria-label="How to Play">
        <h2>How to Play Scrabble Practice Game</h2>        <div class="instructions-content">
            <ol>
                <li>Practice making Scrabble words using the center letter on the board (highlighted in gold).</li>
                <li>Your tile rack shows 7 letters. Each tile displays its Scrabble point value in the corner.</li>
                <li>Click the center letter and your own tiles to create a word (up to 7 letters total).</li>
                <li>The center letter can be used at any position in your word.</li>
                <li><strong>All words are validated against a real English dictionary!</strong> Invalid words will be rejected.</li>
                <li>Controls:
                    <ul>
                        <li><b>Play Word</b> (Alt+W) - Validates and places your word if it uses the center letter</li>
                        <li><b>Shuffle Tiles</b> (Alt+S) - Get new random letters</li>
                        <li><b>Clear Selection</b> (Alt+C) - Reset your word</li>
                        <li><b>New Game</b> (Alt+N) - Start a fresh game</li>
                    </ul>
                </li>
                <li>After placing a valid word:
                    <ul>
                        <li>Points are added to your score</li>
                        <li>Used tiles are replaced automatically</li>
                        <li>The word stays on the board</li>
                    </ul>
                </li>
            </ol>
        </div>
    </section>
</div>

